# Internationalization (i18n) Design — FR/EN Support

**Date**: 2026-02-25
**Status**: Approved — ready for implementation plan
**Approach**: react-i18next + domain-split JSON locale files

---

## 1. Overview

Add full French/English language support to Normandy 1944. The player chooses their language on the main menu. All text — UI chrome, narrative content, soldier data, battle orders, achievements — renders in the chosen language. LLM-generated narrative also generates in the chosen language.

### Decisions Made

| Decision | Choice | Rationale |
|----------|--------|-----------|
| Military terminology | Keep English (SSgt, BAR, MG-42, OPORD, DZ, KIA) | Authentic US Army story — French translation is the narration, not the army |
| Soldier names | Keep English (Bill Henderson, not Guillaume) | American soldiers, American names |
| LLM language support | Yes — LLM generates in the player's chosen language | Full immersion in French |
| Translation source | LLM draft + manual review | Fastest to first draft, highest quality after review |
| First-pass scope | Everything (UI, narrative, characters, orders, achievements) | Complete French experience |
| i18n library | react-i18next | Industry standard, interpolation, plurals, fallback chain |

---

## 2. Language Selector

**Location**: Main menu, above "Begin Operation" button.

```
┌────────────────────────────────┐
│                                │
│       NORMANDY 1944            │
│                                │
│   [ English ]  [ Français ]    │
│                                │
│   [  Begin Operation  ]        │
│   Access code: [________]      │
│                                │
└────────────────────────────────┘
```

**Behavior**:
- Persisted in `localStorage` under `normandy1944_language`
- Default: browser language if `fr`, otherwise `en`
- Changeable only from main menu (not mid-game)
- `data-testid="language-selector"` for the container
- `data-testid="language-en"` and `data-testid="language-fr"` for the buttons
- Active language button is visually highlighted

**What changes**: All UI text, narrative, reference content, LLM generation language.

**What stays English**: Soldier names, military ranks, weapon names, acronyms, location names.

**Time format**: English uses "0215 hrs", French uses "0215 h".

---

## 3. File Structure

```
src/locales/
├── i18n.ts                        # i18next config, language detection, fallback
├── en/
│   ├── ui.json                    # ~55 keys: buttons, labels, headers, menus
│   ├── game.json                  # ~35 keys: status text, alerts, phase names
│   ├── soldiers.json              # 18 soldiers: background + epilogue templates
│   ├── orders.json                # OPORD text + 7 milestone descriptions
│   ├── achievements.json          # 16 achievements: title + description
│   ├── secondInCommand.json       # ~14 keys: veteran + green 2IC comments
│   └── scenes/
│       ├── act1_scene01.json      # narrative + decision texts + outcome texts
│       ├── act1_scene02.json
│       ├── act1_scene03.json
│       ├── act1_scene04.json
│       ├── act1_scene05.json
│       ├── act1_scene06.json
│       └── act1_scene07.json
└── fr/
    └── (exact mirror of en/)
```

### Namespace mapping

| Namespace | File | Key count (est.) | Content |
|-----------|------|-------------------|---------|
| `ui` | `ui.json` | ~55 | Buttons, labels, headers, menus, prompts |
| `game` | `game.json` | ~35 | Status labels, enemy states, phase names, alerts |
| `soldiers` | `soldiers.json` | ~80 | 18 soldiers × (background + 4 epilogue templates) |
| `orders` | `orders.json` | ~10 | OPORD text + milestone descriptions |
| `achievements` | `achievements.json` | ~35 | 16 achievements × (title + description) |
| `secondInCommand` | `secondInCommand.json` | ~14 | Veteran + green comments by trigger type |
| `scenes` | `scenes/act1_*.json` | ~20-30 per scene | Per-scene narrative, decision texts, outcome texts |

### Scene locale file structure

```json
{
  "narrative": "You hit the ground hard. The chute tangles...",
  "narrativeAlt": {
    "assess_before_acting": "Alternate narrative when player has this lesson..."
  },
  "decisions": {
    "landing_gear_check": {
      "text": "Check your gear — what survived the drop?",
      "success": "You pat yourself down methodically...",
      "partial": "You fumble in the darkness...",
      "failure": "Your hands shake too much..."
    },
    "landing_orient": {
      "text": "Try to orient yourself — where did you land?",
      "success": "...",
      "partial": "...",
      "failure": "..."
    }
  },
  "rally": {
    "narrative": "Rally event text if applicable..."
  }
}
```

---

## 4. i18next Configuration

```typescript
// src/locales/i18n.ts
import i18n from 'i18next';
import { initReactI18next } from 'react-i18next';

// Import all namespace files
import enUi from './en/ui.json';
import enGame from './en/game.json';
import frUi from './fr/ui.json';
import frGame from './fr/game.json';
// ... all namespaces

const savedLanguage = localStorage.getItem('normandy1944_language');
const browserLang = navigator.language.startsWith('fr') ? 'fr' : 'en';

i18n.use(initReactI18next).init({
  resources: {
    en: { ui: enUi, game: enGame, /* ... */ },
    fr: { ui: frUi, game: frGame, /* ... */ },
  },
  lng: savedLanguage || browserLang,
  fallbackLng: 'en',
  interpolation: { escapeValue: false },
  defaultNS: 'ui',
});

export default i18n;
```

Key behaviors:
- **Fallback to English**: Any missing French key shows the English version — never blank
- **Static imports**: All JSON files bundled at build time (no async loading needed for ~250 keys)
- **Scene namespaces**: Loaded as sub-keys under a `scenes` namespace, or as separate namespaces per scene

---

## 5. Component Integration

### Pattern 1: UI strings

```tsx
const { t } = useTranslation('ui');
<button>{t('beginOperation')}</button>
```

### Pattern 2: Game mechanics

```tsx
const { t } = useTranslation('game');
<span>{t('enemyStatus.confused')}</span>  // "CONFUSED" or "CONFUS"
<span>{t('time.format', { time: '0215' })}</span>  // "0215 hrs" or "0215 h"
```

### Pattern 3: Scene content

```tsx
const { t } = useTranslation('scenes');
const sceneKey = `act1_scene01`;  // derived from scene.id

// Narrative
<div>{t(`${sceneKey}.narrative`)}</div>

// Decision text
<button>{t(`${sceneKey}.decisions.${decision.id}.text`)}</button>

// Outcome text
<div>{t(`${sceneKey}.decisions.${decision.id}.${outcomeTier}`)}</div>
```

### Pattern 4: Dynamic text with interpolation

```tsx
// "X of Y men survived"  →  "X hommes sur Y ont survécu"
t('epilogue.survived', { count: survivors, total: totalMen })
```

### Migration strategy for scene files

**Phase 1** (non-destructive):
1. Extract English text from scene `.ts` files → `en/scenes/*.json`
2. Components try locale key first, fall back to hardcoded text from scene file
3. Scene `.ts` files unchanged

**Phase 2** (cleanup, optional):
1. Remove hardcoded text from scene `.ts` files
2. Scene files become pure game logic (tiers, state changes, IDs)
3. All text lives in locale JSON files

Phase 2 is optional — the game works correctly in Phase 1. Clean up when convenient.

---

## 6. LLM Integration

### Narrative generation in French

The system prompt gets one additional block when the player's language is French:

```
[LANGUAGE]
Generate all narrative text in French.
Maintain the same terse military tone — short sentences, present tense, second person ("vous").
Keep these terms in English: all soldier names, ranks (SSgt, Sgt, Cpl, PFC, Pvt),
weapon names (BAR, MG-42, Gammon bomb), acronyms (OPORD, DZ, PIR, KIA),
location names (Sainte-Marie-du-Mont, Utah Beach).
Use "h" for time (e.g., "0215 h" not "0215 hrs").
```

### Classification prompt (free-text actions)

Classification stays in English internally — it's a structured JSON response mapping to decision IDs. Only the narration output changes language.

### Epilogue generation

The epilogue prompt adds the same `[LANGUAGE]` block. Epilogues generate in the player's language.

### 2IC comments

When LLM mode is active, 2IC comments generate in the player's language. The trigger system (WHEN the 2IC speaks) is unchanged — only the text output is localized.

### Implementation detail

```typescript
// In narrativeService.ts
function buildNarrativeRequest(state, scene, outcome) {
  const language = i18n.language;  // 'en' or 'fr'
  return {
    ...existingPayload,
    language,  // passed to the Worker
  };
}

// In promptBuilder.ts
function buildSystemPrompt(state, language) {
  let prompt = BASE_SYSTEM_PROMPT;
  if (language === 'fr') {
    prompt += FRENCH_LANGUAGE_BLOCK;
  }
  return prompt;
}
```

---

## 7. Translation Workflow

### Draft generation script

`scripts/translate-draft.ts` — generates French drafts from English using the LLM.

```bash
npm run i18n:draft                           # all missing translations
npm run i18n:draft -- --file scenes/act1_01  # one file
npm run i18n:draft -- --namespace ui         # one namespace
```

The script:
1. Reads all `en/` files
2. Finds keys missing from `fr/` counterparts
3. Sends English text + translation instructions to the LLM
4. Writes French drafts to `fr/` files
5. Reports what was generated

Translation instructions sent to the LLM:

```
Translate this game text from English to French.
Context: WWII tactical text game, D-Day, 101st Airborne.
Tone: Terse, military, immersive. Short sentences.
Keep in English: soldier names, ranks, weapon names, acronyms, locations.
Use "vous" (formal second person) for the player.
```

### Progress tracking script

`scripts/i18n-status.ts` — shows translation coverage.

```bash
$ npm run i18n:status

Translation status (en → fr):
  ui.json              ██████████ 100%  (55/55)
  game.json            ████████░░  80%  (28/35)
  soldiers.json        ░░░░░░░░░░   0%  (0/80)
  orders.json          ██████████ 100%  (10/10)
  achievements.json    ░░░░░░░░░░   0%  (0/35)
  secondInCommand.json ██████████ 100%  (14/14)
  scenes/act1_01.json  ████░░░░░░  40%  (8/20)
  scenes/act1_02.json  ░░░░░░░░░░   0%  (not started)
  ...
Overall: 35% complete (115/~330 keys)
```

### Editing workflow

1. `npm run i18n:draft` → generate French drafts
2. `npm run i18n:status` → see progress
3. Open `fr/scenes/act1_scene01.json` in Cursor
4. Open `en/scenes/act1_scene01.json` side by side
5. Review and polish the French text
6. Repeat per file

---

## 8. Known Risks & Mitigations

### Risk 1: Key drift between scene logic and locale files

**Problem**: Decision IDs in `.ts` scene files must match keys in JSON locale files. If someone renames `landing_gear_check` to `gear_check` in the scene file, the locale key breaks.

**Mitigation**:
- Content validation tests (already exist) extended to check that every decision ID has a corresponding locale key
- A `npm run i18n:validate` script that cross-references scene `.ts` files with locale JSON
- Decision IDs are treated as stable identifiers — renaming requires updating both files

### Risk 2: Dual source of truth during migration

**Problem**: During Phase 1, text exists in both `.ts` scene files (hardcoded English) and JSON locale files. Which is canonical?

**Mitigation**:
- Rule: **Locale files are the source of truth.** Once a key exists in `en/*.json`, that's the canonical version.
- Scene `.ts` hardcoded text becomes dead code — kept for backward compatibility but not displayed
- Phase 2 cleanup removes hardcoded text from `.ts` files when ready
- Tests validate that locale keys match scene structure, not that `.ts` text matches JSON text

### Risk 3: 7,500 words of translation is a real editing commitment

**Problem**: Full French translation is substantial work even with LLM drafts.

**Mitigation**:
- LLM drafts reduce the work from "write 7,500 words in French" to "review and polish 7,500 words"
- i18next fallback means partial translation works — untranslated keys show English
- Priority order for translation:
  1. `ui.json` + `game.json` (most visible, smallest files) — ~90 keys
  2. `orders.json` + `achievements.json` (reference content) — ~45 keys
  3. Scene files one at a time (biggest effort) — ~20 keys each
  4. `soldiers.json` (backgrounds, epilogues) — ~80 keys
- A "90% French" game with a few English fallbacks is playable and shippable

---

## 9. Files Created/Modified

### New files

| File | Purpose |
|------|---------|
| `src/locales/i18n.ts` | i18next configuration |
| `src/locales/en/ui.json` | English UI strings |
| `src/locales/en/game.json` | English game mechanics text |
| `src/locales/en/soldiers.json` | English soldier data |
| `src/locales/en/orders.json` | English battle orders |
| `src/locales/en/achievements.json` | English achievements |
| `src/locales/en/secondInCommand.json` | English 2IC comments |
| `src/locales/en/scenes/act1_scene*.json` | English scene text (7 files) |
| `src/locales/fr/` | French mirror (all above) |
| `src/components/LanguageSelector.tsx` | Language toggle on main menu |
| `scripts/translate-draft.ts` | LLM draft generation script |
| `scripts/i18n-status.ts` | Translation progress tracker |

### Modified files

| File | Change |
|------|--------|
| `src/components/MainMenu.tsx` | Add LanguageSelector component |
| `src/components/GameScreen.tsx` | Use `useTranslation` for scene text |
| `src/components/NarrativePanel.tsx` | Resolve text from locale |
| `src/components/DecisionPanel.tsx` | Resolve decision text from locale |
| `src/components/StatusPanel.tsx` | Translate status labels |
| `src/components/OrdersPanel.tsx` | Translate OPORD and milestones |
| `src/components/RosterPanel.tsx` | Translate column headers, status labels |
| `src/components/LessonJournal.tsx` | Translate headers and placeholders |
| `src/components/AchievementPopup.tsx` | Resolve achievement text from locale |
| `src/components/DeathReport.tsx` | Translate death screen text |
| `src/components/EpilogueScreen.tsx` | Translate epilogue chrome + templates |
| `src/components/WikiPanel.tsx` | Translate placeholder text |
| `src/components/AccessCodeInput.tsx` | Translate labels and errors |
| `src/components/FreeTextInput.tsx` | Translate placeholder |
| `src/services/narrativeService.ts` | Pass language to LLM requests |
| `src/services/promptBuilder.ts` | Add language block to system prompts |
| `src/App.tsx` | Wrap with I18nextProvider |
| `package.json` | Add i18next, react-i18next dependencies |
| `tests/content/validation.test.ts` | Add locale key validation tests |

### Dependencies added

- `i18next`
- `react-i18next`

---

## 10. Testing Strategy

1. **Locale key validation**: Every decision ID in scene files has a matching locale key in both `en/` and `fr/`
2. **Fallback test**: Missing French keys correctly fall back to English
3. **Language switching**: Changing language updates all visible text
4. **LLM prompt test**: French language block included when `language === 'fr'`
5. **Interpolation test**: Dynamic values (men count, time) render correctly in both languages
6. **No blank text**: No component ever renders empty string due to missing translation
