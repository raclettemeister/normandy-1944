# Playthrough Audit — 2026-02-27 (Pre-fix)

Mode traced: **hardcoded fallback mode** (`VITE_NARRATIVE_API_URL` unset, so no LLM narration calls during normal play).

Path traced (one full Act 1 run, all 7 scenes):

1. `act1_landing` → `landing_check_gear`
2. `act1_finding_north` → `north_compass_terrain`
3. `act1_first_contact` → `contact_click_once`
4. `act1_the_sergeant` → `sergeant_clicker`
5. `act1_the_patrol` → `patrol_l_ambush`
6. `act1_the_farmhouse` → `farmhouse_stack_clear`
7. `act1_scene07` → `road_scouts_forward`

---

## Scene 1 → 2 transition

- **Scene:** `act1_landing`
- **Narrative shown (fallback):** landing base narrative + outcome success text from `landing_check_gear`.
- **LLM prompt path (if enabled):**
  - Scene/outcome prompt builder: `buildNarrationPrompt(...)`
  - Fallback chain: `generateOutcomeNarrative(...)` returns `outcome.text` on failure/missing context.
- **Outcome engine result:**
  - Deltas: men `0`, ammo `0`, morale `+5`, readiness `+1` total (`+0` outcome + `+1` passive time)
  - Time: `0115` → `0130`
  - Next scene: `act1_finding_north`
- **Coherence checks:**
  - Narrative ↔ mechanics: **PASS**
  - Next-scene setup continuity: **PASS**
  - Character presence consistency: **PASS** (still alone)
  - Resource-change explanation: **FAIL** (readiness increase from time is not explained in text)

**SPEC section status**

| §1 Tone | §2 Continuity | §3 Five numbers | §4 Time/orders | §5 Narrative↔mechanics | §6 Pacing | §7 LLM fallback |
|---|---|---|---|---|---|---|
| PASS | PASS | FAIL | PASS | PASS | PASS | PASS |

---

## Scene 2 → 3 transition

- **Scene:** `act1_finding_north`
- **Narrative shown (fallback):** base narrative (NOT `narrativeAlt.hasCompass`) + outcome success text from `north_compass_terrain`.
- **LLM prompt path (if enabled):**
  - Same `buildNarrationPrompt(...)` path.
- **Outcome engine result:**
  - Deltas: men `0`, ammo `0`, morale `+5`, readiness `+2` total (`+0` outcome + `+2` passive time)
  - Time: `0130` → `0150`
  - Intel gained: `hasMap=true`
  - Next scene: `act1_first_contact`
- **Coherence checks:**
  - Narrative ↔ mechanics: **FAIL** (`hasCompass` was gained in Scene 1, but Scene 2 fallback still acts as if no compass)
  - Next-scene setup continuity: **PASS**
  - Character presence consistency: **PASS**
  - Resource-change explanation: **FAIL** (passive readiness increase still opaque)

**SPEC section status**

| §1 Tone | §2 Continuity | §3 Five numbers | §4 Time/orders | §5 Narrative↔mechanics | §6 Pacing | §7 LLM fallback |
|---|---|---|---|---|---|---|
| PASS | FAIL | FAIL | PASS | FAIL | PASS | PASS |

---

## Scene 3 → 4 transition

- **Scene:** `act1_first_contact`
- **Narrative shown (fallback):** scene base narrative + outcome success text from `contact_click_once`.
- **LLM prompt path (if enabled):**
  - `buildNarrationPrompt(...)` with outcome context.
- **Outcome engine result:**
  - Deltas: men `+1` (`menGained`), ammo `0`, morale `+5`, readiness `+1` total
  - Time: `0150` → `0205`
  - Next scene: `act1_the_sergeant`
- **Coherence checks:**
  - Narrative ↔ mechanics: **FAIL** (men increase is numeric-only; roster remains empty, so gained trooper is not represented as a present character)
  - Next-scene setup continuity: **FAIL** (state carries `men=1` but no soldier entity; downstream continuity becomes unstable)
  - Character presence consistency: **FAIL**
  - Resource-change explanation: **FAIL** (men changed without roster-visible person)

**SPEC section status**

| §1 Tone | §2 Continuity | §3 Five numbers | §4 Time/orders | §5 Narrative↔mechanics | §6 Pacing | §7 LLM fallback |
|---|---|---|---|---|---|---|
| PASS | FAIL | FAIL | PASS | FAIL | PASS | FAIL |

---

## Scene 4 → 5 transition

- **Scene:** `act1_the_sergeant`
- **Narrative shown (fallback):** scene base narrative + outcome success text from `sergeant_clicker` + rally narrative.
- **LLM prompt path (if enabled):**
  - Outcome prompt: `buildNarrationPrompt(...)`
  - Rally prompt: `buildRallyPrompt(...)`
- **Outcome engine result:**
  - Pre-rally state recalculation collapses prior numeric-only trooper (men derived from active roster)
  - Then rally applies Henderson/Malone/Doyle
  - Net deltas observed at transition end: men becomes `3`, ammo `+10`, morale large jump, readiness `+1` passive
  - Time: `0205` → `0220`
  - Next scene: `act1_the_patrol`
- **Coherence checks:**
  - Narrative ↔ mechanics: **FAIL** (state path includes unexplained men-count correction before rally)
  - Next-scene setup continuity: **PASS** on this branch (Henderson present and patrol scene can proceed)
  - Character presence consistency: **PASS** on this branch
  - Resource-change explanation: **FAIL** (composite men/ammo/morale jump not clearly decomposed for player)

**SPEC section status**

| §1 Tone | §2 Continuity | §3 Five numbers | §4 Time/orders | §5 Narrative↔mechanics | §6 Pacing | §7 LLM fallback |
|---|---|---|---|---|---|---|
| PASS | FAIL | FAIL | PASS | FAIL | PASS | FAIL |

---

## Scene 5 → 6 transition

- **Scene:** `act1_the_patrol`
- **Narrative shown (fallback):** scene alt squad narrative + outcome success text from `patrol_l_ambush`.
- **LLM prompt path (if enabled):**
  - Outcome prompt: `buildNarrationPrompt(...)`
- **Outcome engine result:**
  - Outcome template uses `ammoSpent: -8`
  - Engine applies ammo as `state.ammo - outcome.ammoSpent`, so ammo **increases by 8**
  - Deltas observed: men `0`, ammo `+8` (from 15→23), morale `+8`, readiness `+7` total
  - Time: `0220` → `0240`
  - Next scene: `act1_the_farmhouse`
- **Coherence checks:**
  - Narrative ↔ mechanics: **FAIL (critical)** (text describes firing ambush and expenditure; mechanics grant ammo)
  - Next-scene setup continuity: **PASS**
  - Character presence consistency: **PASS**
  - Resource-change explanation: **FAIL** (ammo increase appears random and contradictory)

**SPEC section status**

| §1 Tone | §2 Continuity | §3 Five numbers | §4 Time/orders | §5 Narrative↔mechanics | §6 Pacing | §7 LLM fallback |
|---|---|---|---|---|---|---|
| PASS | PASS | FAIL | PASS | FAIL | PASS | FAIL |

---

## Scene 6 → 7 transition

- **Scene:** `act1_the_farmhouse`
- **Narrative shown (fallback):** scene alt `hasSecondInCommand` narrative + outcome success text from `farmhouse_stack_clear` + rally narrative.
- **LLM prompt path (if enabled):**
  - Outcome prompt: `buildNarrationPrompt(...)`
  - Rally prompt: `buildRallyPrompt(...)`
- **Outcome engine result:**
  - Outcome template uses `ammoSpent: -2` (so engine adds ammo again)
  - Then rally adds ammo `+15`
  - Deltas observed: men `+2` from rally (to 5), ammo `+17` net (23→40), morale large increase, readiness `+3` total
  - Time: `0240` → `0255`
  - Next scene: `act1_scene07`
- **Coherence checks:**
  - Narrative ↔ mechanics: **FAIL (critical)** (combat/clearing action inflates ammo before rally)
  - Next-scene setup continuity: **PASS**
  - Character presence consistency: **PASS**
  - Resource-change explanation: **FAIL** (large ammo swing feels random)

**SPEC section status**

| §1 Tone | §2 Continuity | §3 Five numbers | §4 Time/orders | §5 Narrative↔mechanics | §6 Pacing | §7 LLM fallback |
|---|---|---|---|---|---|---|
| PASS | PASS | FAIL | PASS | FAIL | PASS | FAIL |

---

## Scene 7 → Act end transition

- **Scene:** `act1_scene07`
- **Narrative shown (fallback):** scene alt `hasSecondInCommand` narrative + outcome success text from `road_scouts_forward`.
- **LLM prompt path (if enabled):**
  - Outcome prompt: `buildNarrationPrompt(...)`
- **Outcome engine result:**
  - Deltas: men `0`, ammo `0`, morale `+8`, readiness `+2` total (passive time)
  - Time: `0255` → `0315`
  - Milestone: `rally_complete` achieved
  - Next scene target in content: `act2_scene01` (not present) → game treats as end/victory.
- **Coherence checks:**
  - Narrative ↔ mechanics: **PASS** for this branch
  - Next-scene setup continuity: **PASS** for current Act-1-only build behavior
  - Character presence consistency: **PASS**
  - Resource-change explanation: **FAIL** (readiness drift still not surfaced clearly)

**SPEC section status**

| §1 Tone | §2 Continuity | §3 Five numbers | §4 Time/orders | §5 Narrative↔mechanics | §6 Pacing | §7 LLM fallback |
|---|---|---|---|---|---|---|
| PASS | PASS | FAIL | PASS | PASS | PASS | PASS |

---

## Summary of failures to fix

Priority-aligned with `docs/SPEC_ALIGNMENT.md`:

1. **§5 Narrative ↔ mechanics (critical):**
   - Ammo sign mismatch in multiple scenes makes gunfights increase ammo.
   - Men gain in Scene 3 is not represented by roster state.
2. **§2 Storyline continuity:**
   - Compass intel gained in Scene 1 is not reflected by Scene 2 fallback narrative selection.
   - Character/state continuity is unstable when men exist without soldier entities.
3. **§3 Five numbers clarity:**
   - Resource delta causality is opaque in outcomes (especially passive readiness and contradictory ammo movement).
4. **§7 Fallback coherence:**
   - Fallback text is present, but in several transitions it contradicts mechanical state updates.

